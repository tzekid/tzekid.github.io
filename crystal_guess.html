
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="dcterms.date" content="2018-12-28" />
  <title>Writing a guessing game in Crystal lang</title>

        <style>
            @font-face {
            font-family: 'Quando';
            font-style: normal;
            font-weight: 400;
            src: local('Quando-Regular'), url(https://fonts.gstatic.com/s/quando/v5/PH1InQe0rvp_yN3TzIuyyQ.woff2) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215;
            }
    
            @font-face {
                font-family: 'Quicksand';
                font-style: normal;
                font-weight: 400;
                src: local('Quicksand Regular'), local('Quicksand-Regular'), url(https://fonts.gstatic.com/s/quicksand/v8/6xKtdSZaM9iE8KbpRA_hK1QN.woff2) format('woff2');
                unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
            }
        </style>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>

    <div class="container">
            <nav class="nav">
                <input type="checkbox" id="nav" class="hidden">
                <label for="nav" class="nav-btn">
                    <i></i>
                    <i></i>
                    <i></i>
                </label>
                <div class="logo">
                    <a href="/"><{ tzekid }></a>
                </div>
                <div class="nav-wrapper">
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="/about">About</a></li>
                        <li><a href="/writings">Writings</a></li>
                        <li><a href="/projects">Projects</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    
<article>
<header id="title-block-header">
<h1 class="title">Writing a guessing game in Crystal lang</h1>
<p class="date">28 December 2018</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#set-up">Set up</a></li>
<li><a href="#processing-a-guess">Processing a Guess</a><ul>
<li><a href="#testing-the-first-part">Testing the first part</a></li>
</ul></li>
<li><a href="#generating-a-secret-number">Generating a secret number</a></li>
<li><a href="#comparing-guesses">Comparing guesses</a><ul>
<li><a href="#union-types-and-error-handling">Union Types and Error Handling</a></li>
<li><a href="#type-inference">Type inference</a></li>
</ul></li>
<li><a href="#looping">Looping</a><ul>
<li><a href="#quitting-after-a-correct-guess">Quitting After a Correct Guess</a></li>
<li><a href="#refactoring">Refactoring</a></li>
</ul></li>
<li><a href="#summary">Summary</a></li>
</ul>
</nav>
<h2 id="introduction">Introduction</h2>
<p>I really wanted to write an introduction to crystal for some time now but didn’t want to only write my take on the already well written <a href="https://crystal-lang.org/docs">docs</a>, so I thought I’d teach by example. (ie. being heavily inspired by <a href="https://doc.rust-lang.org/book/second-edition/ch02-00-guessing-game-tutorial.html">Rust docs</a></p>
<p>In this article I’ll show you the basics of the <a href="https://crystal-lang.org/">crystal</a> language by building a simple guessing game. It will introduce you to core concepts like variables, error handling, loops and more !</p>
<h2 id="set-up">Set up</h2>
<p>For the instructions on installing crystal itself, just:</p>
<p><input id="d4AlCAhjnck0" type="checkbox" class="cbi" /><label class="cbl" for="d4AlCAhjnck0">go to the <a href="https://crystal-lang.org/docs/installation/">official docs</a> and follow the instructions for your platform.</label></p>
<p>To set up a new project you’ll have to <code>init</code>ialize it like so:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1">λ <span class="ex">crystal</span> init app guessing_game</a>
<a class="sourceLine" id="cb1-2" title="2">λ <span class="bu">cd</span> guessing_game</a></code></pre></div>
<p>The first command, <code>crystal init</code>, takes <code>app</code> as the first argument which creates an application skeleton with the second argument, <code>guessing_game</code>, as the project name.</p>
<h2 id="processing-a-guess">Processing a Guess</h2>
<p>Our main file is in <code>src/guessing_game.cr</code>. Ignore <code>require</code> and <code>module</code> for now; better yet, delete everything in the file and start from zero.</p>
<p>The first part of the program will ask for user input, process that input, and check that the input is in the expected form.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb2-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3">print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">guess = gets</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7">puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a></code></pre></div>
<p><code>puts</code> prints the output to the screen with an ’ ’ (newline) afterwards. <code>print</code> is like <code>puts</code> minus the newline. <code>gets</code> waits for the user input which is then assigned to the variable <code>guess</code>.</p>
<p>This line prints out the string we saved the user’s input in. The syntax <code>#{}</code> is a placeholder that holds a value in place. You can print more than one value using <code>#{}</code>. Printing more than one value with <code>puts</code> would look like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" title="1">x = <span class="dv">5</span></a>
<a class="sourceLine" id="cb3-2" title="2">y = <span class="dv">10</span></a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">puts <span class="st">&quot;x = </span><span class="ot">#{</span>x<span class="ot">}</span><span class="st"> and y = </span><span class="ot">#{</span>y<span class="ot">}</span><span class="st">&quot;</span> <span class="co"># =&gt; &quot;x = 5 and y = 10&quot;</span></a></code></pre></div>
<p>The <code>#</code> symbolizes the beginning of a comment. The comment will take up the rest of the line. As of yet there is no selective or multiline comment syntax in Crystal. The <code># =&gt;</code> syntax is officially used to describe the output of a line.</p>
<p><input id="QhMPsAyq3uA3" type="checkbox" class="cbi" /><label class="cbl" for="QhMPsAyq3uA3">(optional) You can read more about <a href="https://crystal-lang.org/docs/syntax_and_semantics/assignment.html">variable assignment</a> or more about <a href="https://crystal-lang.org/docs/syntax_and_semantics/literals/string.html">strings</a> on the official docs.</label></p>
<h3 id="testing-the-first-part">Testing the first part</h3>
<p>You can run the program so far like so:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1">λ <span class="ex">crystal</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="ex">Guess</span> a number!</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="ex">Please</span> input your guess: 420</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="ex">You</span> guessed: 420</a></code></pre></div>
<p>At this point, the first part of the game is done: we’re getting input from the keyboard and then printing it.</p>
<h2 id="generating-a-secret-number">Generating a secret number</h2>
<p>Next, we need to generate a secret number that the user will try to guess. The secret number should be different every time so the game is fun to play more than once. Let’s use a random number between 1 and 100 so the game isn’t too difficult.</p>
<p>Generating a simple random number in Crystal is fairly easy with the help of the <code>rand</code> function. It takes an Int as the max range, so giving it 100 will generate numbers between 0 and 99. Wait what?</p>
<p>Yeah, apparently the <code>rand</code> function only generates numbers from 0 up until but not including the max value we give it. To get the range we want, we’ll have to write <code>rand(100) + 1</code>, which will generate numbers between 1 and 100 - the range we’re actually looking for!</p>
<p>Let’s start using the built in <code>rand</code> function</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb5-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb5-3" title="3"></a>
<a class="sourceLine" id="cb5-4" title="4">secret_number = rand(<span class="dv">100</span>) + <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-5" title="5">puts <span class="st">&quot;The secret number is: </span><span class="ot">#{</span>secret_number<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7">print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb5-8" title="8">guess = gets</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10">puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a></code></pre></div>
<p><input id="OuT1vO36q5b2" type="checkbox" class="cbi" /><label class="cbl" for="OuT1vO36q5b2">(optional) You can have a glance at the <a href="https://crystal-lang.org/api/master/Random.html">Random</a> module on the <a href="https://crystal-lang.org/api/master/">API docs</a></label></p>
<p>It is always good to check the docs when you don’t understand something, or when a StackOverflow answers get you only so far. At this point in time the documentation is extensive, but far from complete, and because the Crystal lang is written in itself, you can easily dive into the source code at any time to get a better understanding of the undelying concepts.</p>
<p>The second line that we added to the code prints the secret number. This is useful while we’re developing the program to be able to test it, but we’ll delete it from the final version. It’s not much of a game if the program prints the answer as soon as it starts!</p>
<p>Try running the program a few times:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1">λ <span class="ex">cr</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="ex">Guess</span> a number!</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="ex">The</span> secret number is: 30</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="ex">Please</span> input your guess: 20</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="ex">You</span> guessed: 20</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7">λ <span class="ex">cr</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="ex">Guess</span> a number!</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="ex">The</span> secret number is: 96</a>
<a class="sourceLine" id="cb6-10" title="10"><span class="ex">Please</span> input your guess: 92</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="ex">You</span> guessed: 92</a></code></pre></div>
<h2 id="comparing-guesses">Comparing guesses</h2>
<p>Now that we have user input and a random number, we can compare them:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb7-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb7-3" title="3"></a>
<a class="sourceLine" id="cb7-4" title="4">secret_number = rand(<span class="dv">100</span>) + <span class="dv">1</span></a>
<a class="sourceLine" id="cb7-5" title="5">puts <span class="st">&quot;The secret number is: </span><span class="ot">#{</span>secret_number<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-6" title="6"></a>
<a class="sourceLine" id="cb7-7" title="7">print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb7-8" title="8">guess = gets</a>
<a class="sourceLine" id="cb7-9" title="9"></a>
<a class="sourceLine" id="cb7-10" title="10">puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="kw">if</span> guess &lt; secret_number</a>
<a class="sourceLine" id="cb7-13" title="13">    puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="kw">elsif</span> guess &gt; secret_number</a>
<a class="sourceLine" id="cb7-15" title="15">    puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="kw">else</span></a>
<a class="sourceLine" id="cb7-17" title="17">    puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="kw">end</span></a></code></pre></div>
<p>Now, we could try using an <code>if, else</code> expression to compare our guesses.</p>
<p><input id="5FWRzfEgAtNC" type="checkbox" class="cbi" /><label class="cbl" for="5FWRzfEgAtNC">You can read more about <a href="https://crystal-lang.org/docs/syntax_and_semantics/if.html">the <code>if</code> syntax on the docs.</a></label></p>
<p>But, if we try to compile the program we get errors:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1">λ <span class="ex">crystal</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ex">Error</span> in src/guessing_game.cr:11: undefined method <span class="st">&#39;&lt;&#39;</span> for Nil (compile-time type is (String <span class="kw">|</span> <span class="ex">Nil</span>))</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">if</span> <span class="ex">guess</span> <span class="op">&lt;</span> secret_number</a>
<a class="sourceLine" id="cb8-5" title="5">            ^</a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="ex">Rerun</span> with --error-trace to show a complete error trace.</a></code></pre></div>
<p>That might seem very alien at first, but the Crystal compiler is here to help us. Crystal is a statically typed, compiled language. When we run the program from the terminal, Crystal more or less just compiles the program without any optimization flags for a quick feedback loop while writing the program.</p>
<h3 id="union-types-and-error-handling">Union Types and Error Handling</h3>
<p>We don’t say that guess should be a number, but the compiler infers the variable type from the <code>gets</code> function - because <code>gets</code> can be either a <code>String</code> when the user types in something or a <code>Nil</code> when he doesn’t give any input, the Crystal compiler prepares itself for both outputs. <code>(String | Nil)</code> is called the <a href="https://crystal-lang.org/docs/syntax_and_semantics/union_types.html">Union Type</a> of String and Nil.</p>
<p>The compiler warns us that <code>guess</code> can be a <code>Nil</code> at compile time, which would break the whole program and doesn’t allow us to go any further until we fix it.</p>
<p>We just need to say that we want a valid input from the user, otherwise the whole code block should be ignored. We do that with something like:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># ...</span></a>
<a class="sourceLine" id="cb9-2" title="2">print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">if</span> guess = gets</a>
<a class="sourceLine" id="cb9-4" title="4">    puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6">    <span class="kw">if</span> guess &lt; secret_number</a>
<a class="sourceLine" id="cb9-7" title="7">    puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb9-8" title="8">    <span class="kw">elsif</span> guess &gt; secret_number</a>
<a class="sourceLine" id="cb9-9" title="9">    puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb9-10" title="10">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb9-11" title="11">    puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb9-12" title="12">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="kw">end</span></a></code></pre></div>
<h3 id="type-inference">Type inference</h3>
<p>By encapsulating <code>guess = gets</code> we ensure that when the <code>guess</code> is <em>not</em> <code>Nil</code>, the code block will run. If we tried to run the code, we’ll run in another problem!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1">λ <span class="ex">cr</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="ex">Error</span> in src/guessing_game.cr:10: no overload matches <span class="st">&#39;String#&lt;&#39;</span> with type Int32</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="ex">Overloads</span> are:</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="ex">-</span> Comparable(T)#<span class="op">&lt;(</span><span class="ex">other</span> : T<span class="op">)</span></a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="kw">if</span> <span class="ex">guess</span> <span class="op">&lt;</span> secret_number</a></code></pre></div>
<p>This just means that the compiler expected a number (ie. an <code>Int</code>), but got a <code>String</code> instead. What we now need to do is convert the string to an integer; and another problem could arise from that too, namely users who do not enter valid numbers !</p>
<p><input id="lk4J7XtCInLz" type="checkbox" class="cbi" /><label class="cbl" for="lk4J7XtCInLz">(optional) Have a look at Crystals <a href="https://crystal-lang.org/docs/syntax_and_semantics/type_inference.html">Type inference</a> and <a href="https://crystal-lang.org/docs/syntax_and_semantics/exception_handling.html">Exception Handling</a> chapters.</label></p>
<p>Converting an non-number string to an integer will raise an error. If you come from a C# or JavaScript background your first instinct, as was mine, was to use a <code>try..catch</code>. In crystal you do not merely ‘catch’ the error, you ‘rescue’ it with the <code>begin..rescue</code> syntax which is more or less identical to the <code>try..catch</code> one.</p>
<p>The code will now look something like so:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># ...</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">begin</span></a>
<a class="sourceLine" id="cb11-3" title="3">    guessed_number = guess.to_i</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">rescue</span></a>
<a class="sourceLine" id="cb11-5" title="5">    puts <span class="st">&quot;</span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st"> is not a number!&quot;</span></a>
<a class="sourceLine" id="cb11-6" title="6">    exit <span class="dv">1</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="kw">end</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9">puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb11-10" title="10"></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="kw">if</span> guessed_number &lt; secret_number</a>
<a class="sourceLine" id="cb11-12" title="12">    puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="kw">elsif</span> guessed_number &gt; secret_number</a>
<a class="sourceLine" id="cb11-14" title="14">    <span class="co"># ...</span></a></code></pre></div>
<p>In the code block after <code>begin</code>, ie. in the one line, we expect an exception to be raised if the user doesn’t enter a valid number. If the user happens to do so, the exception is catched and the program <code>rescue</code>d, ie. it will not just go down, crash and burn.</p>
<p>It will instead run the code block after the <code>rescue</code> tag, where the behaviour of catching such an exception is defined. Take care of how you use the <code>begin..rescue</code> expression, because by supressing exceptions and not handling them properly you can introduce bugs into your code.</p>
<figure>
<img src="/img/basics_vscode.png" alt="Image of stuff" /><figcaption>Image of stuff</figcaption>
</figure>
<p>The code should now compile. Try it out ! If the user doesn’t enter a valid number, you can now see the error message we implemented.</p>
<h2 id="looping">Looping</h2>
<p>The <code>loop</code> keyword gives us an infinite loop. Add that now to give users more chances at guessing the number:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb12-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4">secret_number = rand(<span class="dv">100</span>) + <span class="dv">1</span></a>
<a class="sourceLine" id="cb12-5" title="5">puts <span class="st">&quot;The secret number is: </span><span class="ot">#{</span>secret_number<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">loop <span class="kw">do</span></a>
<a class="sourceLine" id="cb12-8" title="8">    print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9">    <span class="kw">if</span> guess = gets</a>
<a class="sourceLine" id="cb12-10" title="10">    <span class="kw">begin</span></a>
<a class="sourceLine" id="cb12-11" title="11">        guessed_number = guess.to_i</a>
<a class="sourceLine" id="cb12-12" title="12">    <span class="kw">rescue</span></a>
<a class="sourceLine" id="cb12-13" title="13">        puts <span class="st">&quot;</span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st"> is not a number!&quot;</span></a>
<a class="sourceLine" id="cb12-14" title="14">        exit <span class="dv">1</span></a>
<a class="sourceLine" id="cb12-15" title="15">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb12-16" title="16"></a>
<a class="sourceLine" id="cb12-17" title="17">    puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb12-18" title="18"></a>
<a class="sourceLine" id="cb12-19" title="19">    <span class="kw">if</span> guessed_number &lt; secret_number</a>
<a class="sourceLine" id="cb12-20" title="20">        puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb12-21" title="21">    <span class="kw">elsif</span> guessed_number &gt; secret_number</a>
<a class="sourceLine" id="cb12-22" title="22">        puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb12-23" title="23">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb12-24" title="24">        puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb12-25" title="25">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb12-26" title="26">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb12-27" title="27"><span class="kw">end</span></a></code></pre></div>
<p>As you can see, we’ve moved everything into a loop from the guess input prompt onward. Be sure to indent those lines and run the program again. Notice that there is a new problem because the program is doing exactly what we told it to do: ask for another guess forever! It doesn’t seem like the user can quit!</p>
<p>The user could always halt the program by using the keyboard shortcut <code>Ctrl-C</code>. But there’s another way to escape this insatiable monster: if the user enters a non-number answer, the program will crash. The user can take advantage of that in order to quit, as shown here:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">λ <span class="ex">crystal</span> src/guessing_game.cr</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="ex">Guess</span> a number!</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="ex">The</span> secret number is: 19</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="ex">Please</span> input your guess: 42</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="ex">You</span> guessed: 42</a>
<a class="sourceLine" id="cb13-6" title="6"><span class="ex">Too</span> big!</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="ex">Please</span> input your guess: 19</a>
<a class="sourceLine" id="cb13-8" title="8"><span class="ex">You</span> guessed: 19</a>
<a class="sourceLine" id="cb13-9" title="9"><span class="ex">You</span> win!</a>
<a class="sourceLine" id="cb13-10" title="10"><span class="ex">Please</span> input your guess: quit</a>
<a class="sourceLine" id="cb13-11" title="11"><span class="ex">You</span> guessed: quit</a>
<a class="sourceLine" id="cb13-12" title="12"><span class="ex">ERROR</span>: this String cannot be converted to Int: quit</a></code></pre></div>
<p>Typing <code>quit</code> actually quits the game, but so will any other non-number input. However, this is suboptimal to say the least. We want the game to automatically stop when the correct number is guessed.</p>
<h3 id="quitting-after-a-correct-guess">Quitting After a Correct Guess</h3>
<p>Let’s program the game to quit when the user wins by adding a <code>break</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="co"># ...</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">if</span> guessed_number &lt; secret_number</a>
<a class="sourceLine" id="cb14-4" title="4">    puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">elsif</span> guessed_number &gt; secret_number</a>
<a class="sourceLine" id="cb14-6" title="6">    puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">else</span></a>
<a class="sourceLine" id="cb14-8" title="8">    puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb14-9" title="9">    <span class="kw">break</span></a>
<a class="sourceLine" id="cb14-10" title="10"><span class="kw">end</span></a>
<a class="sourceLine" id="cb14-11" title="11"><span class="co"># ...</span></a></code></pre></div>
<p>By adding the <code>break</code> line after <code>You win!</code>, the program will exit the loop when the user guesses the secret number correctly. Exiting the loop also means exiting the program, because there are no more instructions to be run.</p>
<p>Not quiting if the user enters a string would make the whole experience more enjoying. For that, we could replace the <code>exit 1</code> from the <code>begin..rescue</code> expression with a <code>next</code>.</p>
<p><input id="JhGinCjI0lS9" type="checkbox" class="cbi" /><label class="cbl" for="JhGinCjI0lS9">(optional) You can read more about the <a href="https://crystal-lang.org/docs/syntax_and_semantics/control_expressions.html">Control expressions</a> from the docs.</label></p>
<p>Now everything in the program should work as expected. Let’s delete the <code>puts</code> that outputs the secret number, and try to actually <code>build</code> the program!</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1">λ <span class="ex">crystal</span> build src/guessing_game.cr --release</a></code></pre></div>
<p><code>build</code> compiles and packs your code into a runnable executable. The <code>--release</code> flag tells the compiler to apply optimizations which will make the program much faster, but the code will take longer to compile. You now have an executable <code>guessing_game</code> which you can run. Let’s try running it:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1">λ <span class="ex">./guessing_game</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="ex">Guess</span> a number!</a>
<a class="sourceLine" id="cb16-3" title="3"><span class="ex">Please</span> input your guess: 60</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="ex">You</span> guessed: 60</a>
<a class="sourceLine" id="cb16-5" title="5"><span class="ex">Too</span> big!</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="ex">Please</span> input your guess: two</a>
<a class="sourceLine" id="cb16-7" title="7"><span class="ex">Please</span> input your guess: three</a>
<a class="sourceLine" id="cb16-8" title="8"><span class="ex">Please</span> input your guess: 44</a>
<a class="sourceLine" id="cb16-9" title="9"><span class="ex">You</span> guessed: 44</a>
<a class="sourceLine" id="cb16-10" title="10"><span class="ex">Too</span> big!</a>
<a class="sourceLine" id="cb16-11" title="11"><span class="ex">Please</span> input your guess: 40</a>
<a class="sourceLine" id="cb16-12" title="12"><span class="ex">You</span> guessed: 40</a>
<a class="sourceLine" id="cb16-13" title="13"><span class="ex">You</span> win!</a></code></pre></div>
<p>This is the code so far:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb17-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb17-3" title="3"></a>
<a class="sourceLine" id="cb17-4" title="4">secret_number = rand(<span class="dv">100</span>) + <span class="dv">1</span></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co"># puts &quot;The secret number is: #{secret_number}&quot;</span></a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7">loop <span class="kw">do</span></a>
<a class="sourceLine" id="cb17-8" title="8">    print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb17-9" title="9">    </a>
<a class="sourceLine" id="cb17-10" title="10">    <span class="kw">if</span> guess = gets</a>
<a class="sourceLine" id="cb17-11" title="11">    <span class="kw">begin</span></a>
<a class="sourceLine" id="cb17-12" title="12">        guessed_number = guess.to_i</a>
<a class="sourceLine" id="cb17-13" title="13">    <span class="kw">rescue</span></a>
<a class="sourceLine" id="cb17-14" title="14">        puts <span class="st">&quot;</span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st"> is not a number!&quot;</span></a>
<a class="sourceLine" id="cb17-15" title="15">        <span class="kw">next</span></a>
<a class="sourceLine" id="cb17-16" title="16">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb17-17" title="17"></a>
<a class="sourceLine" id="cb17-18" title="18">    puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb17-19" title="19"></a>
<a class="sourceLine" id="cb17-20" title="20">    <span class="kw">if</span> guessed_number &lt; secret_number</a>
<a class="sourceLine" id="cb17-21" title="21">        puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb17-22" title="22">    <span class="kw">elsif</span> guessed_number &gt; secret_number</a>
<a class="sourceLine" id="cb17-23" title="23">        puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb17-24" title="24">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb17-25" title="25">        puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb17-26" title="26">        <span class="kw">break</span></a>
<a class="sourceLine" id="cb17-27" title="27">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb17-28" title="28">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="kw">end</span></a></code></pre></div>
<h3 id="refactoring">Refactoring</h3>
<p>Even though everything works, the syntax looks a bit off and we could improve in some parts - eg. using <code>begin..rescue</code> is not the most optimal way to do it.</p>
<p>Until now <code>to_i</code> crashed upon failure, that’s why we made good use of the <code>begin..rescue</code> statement. Thankfully there are other ways to do it.</p>
<p><input id="fFm8oKKK9rTe" type="checkbox" class="cbi" /><label class="cbl" for="fFm8oKKK9rTe">You can have a look at the <a href="https://crystal-lang.org/api/master/String.html">String</a> section of the Crystal API where.</label></p>
<p>you can see the <a href="https://crystal-lang.org/api/master/String.html#to_i%3F%28base%3AInt%3D10%2Cwhitespace%3Dtrue%2Cunderscore%3Dfalse%2Cprefix%3Dfalse%2Cstrict%3Dtrue%29-instance-method"><code>to_i?</code></a> method. It acts exactly like we expect - execept it doesn’t crash! It simply returns a <code>Nil</code> on failure.</p>
<p>That means that we could catch the error with a simple <code>if</code> statement. We could be even more fancy, and use the <a href="https://crystal-lang.org/docs/syntax_and_semantics/unless.html"><code>unless</code></a> statement, which is a negated if. Using it instead of <code>if !</code> makes the code easier to read. The refactored bit looks like this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb18-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co"># ...</span></a>
<a class="sourceLine" id="cb18-3" title="3">    puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb18-4" title="4"></a>
<a class="sourceLine" id="cb18-5" title="5">    <span class="kw">unless</span> guess = guess.to_i?</a>
<a class="sourceLine" id="cb18-6" title="6">    puts <span class="st">&quot;</span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st"> is not a number!&quot;</span></a>
<a class="sourceLine" id="cb18-7" title="7">    <span class="kw">next</span></a>
<a class="sourceLine" id="cb18-8" title="8">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb18-9" title="9"></a>
<a class="sourceLine" id="cb18-10" title="10">    <span class="kw">if</span> guess &lt; secret_number</a>
<a class="sourceLine" id="cb18-11" title="11"><span class="co"># ...</span></a></code></pre></div>
<p>Now, if the user enters something else rather than a number, the <code>to_i?</code> method will return a <code>Nil</code>, which will trigger the <code>unless</code> statement and skip to the <code>next</code> iteration in the loop.</p>
<p>As you can also see, after the refactor the extra variable <code>guessed_number</code> is made redundant. We can now just use <code>guess</code> instead in the whole program.</p>
<p>Another nifty thing we could do to get rid of the indendation after <code>if guess = gets</code> is to handle the negative case at the beginning of the loop.</p>
<p>That’s a good opportunity to show you a new syntax bit! Namely the use of the <code>if</code>, or <code>unless</code> statement as a suffix.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb19-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co"># ...</span></a>
<a class="sourceLine" id="cb19-3" title="3">print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb19-4" title="4"></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="kw">next</span> <span class="kw">unless</span> guess = gets</a>
<a class="sourceLine" id="cb19-6" title="6"></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="co"># The above is the same as:</span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="co"># unless guess = gets</span></a>
<a class="sourceLine" id="cb19-9" title="9"><span class="co">#   next</span></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co"># end</span></a>
<a class="sourceLine" id="cb19-11" title="11"></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="kw">unless</span> guess = guess.to_i?</a>
<a class="sourceLine" id="cb19-13" title="13"><span class="co">#...</span></a></code></pre></div>
<p>That way, the compiler will recognize that we handled the negative case first and that there are no runtime errors left to handle and let get rid of the extra indentation.</p>
<p><a href="https://github.com/rx14">RX14</a> pointed out another interesting nitpick. To <a href="https://www.reddit.com/r/crystal_programming/comments/6qcxa3/writing_a_guessing_game_in_crystal_lang/dl91dfy/">quote him</a>: &gt; <code>gets</code> will only return <code>nil</code> if the input IO was closed, which necessarily means that all future calls will return <code>nil</code> too. Using <code>next</code> instead of <code>break</code> in the <code>gets</code> guard statement will cause you to enter an infinite loop if you use Ctrl-D (which closes the input file descriptor in the terminal).</p>
<p>By replacing the <code>next</code> before <code>gets</code> with a <code>break</code>, we will get the behaviour we expect when the user uses Ctrl-D.</p>
<p>This is the final version of the code:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># src/guessing_game.cr</span></a>
<a class="sourceLine" id="cb20-2" title="2">puts <span class="st">&quot;Guess a number!&quot;</span></a>
<a class="sourceLine" id="cb20-3" title="3">secret_number = rand(<span class="dv">100</span>) + <span class="dv">1</span></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="co"># puts &quot;The secret number is: #{secret_number}&quot;</span></a>
<a class="sourceLine" id="cb20-5" title="5"></a>
<a class="sourceLine" id="cb20-6" title="6">loop <span class="kw">do</span></a>
<a class="sourceLine" id="cb20-7" title="7">    print <span class="st">&quot;Please input your guess: &quot;</span></a>
<a class="sourceLine" id="cb20-8" title="8">    <span class="kw">break</span> <span class="kw">unless</span> guess = gets</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10">    <span class="kw">unless</span> guess = guess.to_i?</a>
<a class="sourceLine" id="cb20-11" title="11">    puts <span class="st">&quot;</span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st"> is not a number!&quot;</span></a>
<a class="sourceLine" id="cb20-12" title="12">    <span class="kw">next</span></a>
<a class="sourceLine" id="cb20-13" title="13">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb20-14" title="14"></a>
<a class="sourceLine" id="cb20-15" title="15">    puts <span class="st">&quot;You guessed: </span><span class="ot">#{</span>guess<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb20-16" title="16"></a>
<a class="sourceLine" id="cb20-17" title="17">    <span class="kw">if</span> guess &lt; secret_number</a>
<a class="sourceLine" id="cb20-18" title="18">    puts <span class="st">&quot;Too small!&quot;</span></a>
<a class="sourceLine" id="cb20-19" title="19">    <span class="kw">elsif</span> guess &gt; secret_number</a>
<a class="sourceLine" id="cb20-20" title="20">    puts <span class="st">&quot;Too big!&quot;</span></a>
<a class="sourceLine" id="cb20-21" title="21">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb20-22" title="22">    puts <span class="st">&quot;You win!&quot;</span></a>
<a class="sourceLine" id="cb20-23" title="23">    <span class="kw">break</span></a>
<a class="sourceLine" id="cb20-24" title="24">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb20-25" title="25"><span class="kw">end</span></a></code></pre></div>
<h2 id="summary">Summary</h2>
<p>At this point you’ve successfully built the guessing game! Congratulations!</p>
<p>By doing that you’ve learned about the basics of variable assignment, control expressions, exception handling and the idiomatic way of doing things in Crystal.</p>
<p><strong>From this point</strong> I’d recommend you have a go at the <a href="https://crystal-lang.org/docs/">official Crystal Book</a> if you haven’t already, and <a href="https://github.com/askn/crystal-by-example">Crystal by Example</a> is another resource that is always handy for a beginner. For a great introduction into Crystal app development try <a href="http://serdardogruyol.com/building-a-realtime-chat-app-with-crystal-and-kemal">Building a realtime Chat application with Crystal and Kemal</a>.</p>
<hr />
<p>Many thanks to <a href="https://github.com/rx14">RX14</a> for providing all the helpful feedback :) You can check his github to find loads of interesting projects, many of which written in Crystal!</p>
<p>Other great resources to learn: the <a href="https://gitter.im/crystal-lang/crystal">gitter</a> channel is where a lot of nice and helpful people hang around - come by and say hi! If you have broader questions check out the <a href="https://stackoverflow.com/questions/tagged/crystal-lang">stack-overflow</a> subsection for crystal-lang. There’s also the <a href="https://github.com/veelenga/awesome-crystal">awesome-crystal</a> list of projects where you can find most things crystal. And, of course, there’s the <a href="http://www.crystalweekly.com/">Crystal Weekly</a> which provides you with the latest news.</p>
<a class='up-btn' href='#title-block-header'><{ ⇡ }></a>
</article>
</body>
</html>
